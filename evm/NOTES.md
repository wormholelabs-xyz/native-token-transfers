# Notes on splitting token from base

## MangerBase

### Implements (Should it implement all these?)

- IManagerBase,
- TransceiverRegistry,
- PausableOwnable,
- ReentrancyGuardUpgradeable,
- Implementation

### Functionality Provided

- Stores the following:
  - Transceiver registry
  - Thresholds
  - Attestations
  - Message sequence number
- Has the following functionality:
  - `quoteDeliveryPrice`
  - Record attestation
  - Send message

### Simple Changes Made

- Moved the following from `ManagerBase` to `NttManager:

  - Token
  - Mode
  - `_prepareForTransfer`

### Possible Ideas

- Maybe we could [like an external library](https://book.getfoundry.sh/reference/forge/forge-create#linker-options) for admin functionality.

### Contract Sizes

#### Before we started

```bash
evm (main)$ forge build --sizes --via-ir --skip test

╭-----------------------------------------+------------------+-------------------+--------------------+---------------------╮
| Contract                                | Runtime Size (B) | Initcode Size (B) | Runtime Margin (B) | Initcode Margin (B) |
+===========================================================================================================================+
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManager                              | 24,066           | 25,673            | 510                | 23,479              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManagerNoRateLimiting                | 17,141           | 18,557            | 7,435              | 30,595              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| TestManager                             | 8,981            | 10,259            | 15,595             | 38,893              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|

```

- Note the `TestManager` just instantiates `ManagerBase.sol`.

#### After simple changes

```bash
evm (main)$ forge build --sizes --via-ir --skip test

|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManager                              | 24,066           | 25,676            | 510                | 23,476              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManagerNoRateLimiting                | 18,788           | 20,281            | 5,788              | 28,871              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| TestManager                             | 8,368            | 9,511             | 16,208             | 39,641              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|

```

```
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManager                              | 23,907           | 25,510            | 669                | 23,642              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManagerHelpersLib                    | 58               | 87                | 24,518             | 49,065              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManagerNoRateLimiting                | 18,644           | 20,130            | 5,932              | 29,022              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
```

- Question: Why did `NttManagerNoRateLimiting` grow so much??

#### Creating TransceiverRegistryAdmin

#### Before

```bash
evm (main)$ forge build --sizes --via-ir --skip test

╭-----------------------------------------+------------------+-------------------+--------------------+---------------------╮
| Contract                                | Runtime Size (B) | Initcode Size (B) | Runtime Margin (B) | Initcode Margin (B) |
+===========================================================================================================================+
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManager                              | 24,066           | 25,673            | 510                | 23,479              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManagerNoRateLimiting                | 17,141           | 18,557            | 7,435              | 30,595              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|

```

#### After

```bash
evm (main)$ forge build --sizes --via-ir --skip test

|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManager                              | 23,220           | 26,937            | 1,356              | 22,215              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManagerNoRateLimiting                | 16,254           | 19,713            | 8,322              | 29,439              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|

```

#### Creating MsgManagerBase

#### Before

```bash
evm (main)$ forge build --sizes --via-ir --skip test

╭-----------------------------------------+------------------+-------------------+--------------------+---------------------╮
| Contract                                | Runtime Size (B) | Initcode Size (B) | Runtime Margin (B) | Initcode Margin (B) |
+===========================================================================================================================+
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManager                              | 24,066           | 25,673            | 510                | 23,479              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManagerNoRateLimiting                | 17,141           | 18,557            | 7,435              | 30,595              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|

```

#### After

```bash
evm (main)$ forge build --sizes --via-ir --skip test

|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManager                              | 24,076           | 25,719            | 500                | 23,433              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|
| NttManagerNoRateLimiting                | 18,496           | 19,949            | 6,080              | 29,203              |
|-----------------------------------------+------------------+-------------------+--------------------+---------------------|

```
